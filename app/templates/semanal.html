<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Agenda Semanal - Corte em Dia</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/semanal.css') }}">
</head>
<body>
    {% include 'partials/sidebar.html' %}

    <main class="content">
        <h1>Agenda Semanal</h1>

        <div class="filtros-container">
            <div class="form-group">
                <label for="selectProfissional">Profissional:</label>
                <select id="selectProfissional" name="profissional">
                    {% for prof_id, prof_data in profissionais.items() %}
                        <option value="{{ prof_id }}" {% if prof_id == profissional_selecionado %}selected{% endif %}>
                            {{ prof_data.nome }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="nav-semana">
                <a href="{{ url_for('semanal.semanal', profissional=profissional_selecionado, offset=offset-1) }}" class="btn">&lt; Anterior</a>
                <span class="titulo-semana">{{ titulo_semana }}</span>
                <a href="{{ url_for('semanal.semanal', profissional=profissional_selecionado, offset=offset+1) }}" class="btn">Próxima &gt;</a>
            </div>
        </div>

        <div class="agenda-semanal-container">
            {% for dia in dias %}
            <div class="coluna-dia">
                <div class="coluna-dia-header">
                    {{ dia.nome }}<br>
                    <small>{{ dia.data_formatada }}</small>
                </div>
                <div class="coluna-dia-body">
                    {% if dia.slots %}
                        {% for slot in dia.slots %}
                             {% if slot.status == 'ocupado' %}
                                <div class="slot ocupado">
                                    <span class="slot-hora">{{ slot.hora }}</span>
                                    <span>{{ slot.cliente }}</span>
                                </div>
                            {% else %}
                                <div class="slot vago">{{ slot.hora }}</div>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <div class="slot vago">-</div> {# Mostra um traço se não houver slots #}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </main>
    
    <script>
        function inicializarSidebar() {
    // Lógica para o menu dropdown
    document.querySelectorAll('.sidebar li.has-submenu').forEach(item => {
        item.addEventListener('click', (event) => {
            event.stopPropagation();
            const submenu = item.nextElementSibling;
            if (submenu && submenu.classList.contains('submenu')) {
                submenu.classList.toggle('open');
                submenu.hidden = !submenu.classList.contains('open');
                item.classList.toggle('open');
            }
        });
    });

    // Lógica para o botão de logout
    const logoutButton = document.getElementById('logoutBtn');
        if (logoutButton) {
            logoutButton.addEventListener('click', () => {
                // Futuramente, chamar uma rota de logout no Flask
                console.log("Logout clicado");
                window.location.href = "/"; // Redireciona para a página de login/inicial
            });
        }
    }
    document.getElementById('selectProfissional').addEventListener('change', function() {
            window.location.href = `{{ url_for('semanal.semanal') }}?profissional=${this.value}&offset=0`;
        });


    window.addEventListener('DOMContentLoaded', () => {
        // Como a sidebar é incluída pelo Flask, o HTML dela já está aqui.
        // Primeiro, inicializamos a sidebar.
        inicializarSidebar();
    });

    </script>
</body>
</html>